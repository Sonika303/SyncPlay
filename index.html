<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SyncPlay</title>
<style>
body{margin:0;font-family:Arial;height:100vh;display:flex;justify-content:center;align-items:center;background:#fff}
.box{width:280px;text-align:center}
button,input{width:100%;padding:12px;margin:6px 0;font-size:16px}
</style>
</head>
<body>

<div class="box">
  <h2>SyncPlay</h2>
  <button id="googleSignIn">Sign in with Google</button>
  <div id="userInfo" style="display:none">
    <p id="usernameDisplay"></p>
    <button onclick="createParty()">Create Party</button>
    <input id="code" placeholder="Enter 5-digit Code">
    <button onclick="joinParty()">Join Party</button>
  </div>
</div>

<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-analytics.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCODp3h025sM3jl7Ji0GJgVuGoWCD1wddU",
    authDomain: "syncplay-17b6e.firebaseapp.com",
    databaseURL: "https://syncplay-17b6e-default-rtdb.firebaseio.com",
    projectId: "syncplay-17b6e",
    storageBucket: "syncplay-17b6e.firebasestorage.app",
    messagingSenderId: "86016195929",
    appId: "1:86016195929:web:40262a28786f2ead712048",
    measurementId: "G-3NBT4GJ0FX"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  // Elements
  const googleBtn = document.getElementById("googleSignIn");
  const userInfo = document.getElementById("userInfo");
  const usernameDisplay = document.getElementById("usernameDisplay");

  // Google Sign-In
  googleBtn.onclick = async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;
      // UID is unique for every Google login
      const username = user.displayName || "Player";
      const uid = user.uid;
      sessionStorage.setItem("u", username);
      sessionStorage.setItem("uid", uid);
      usernameDisplay.textContent = `Hello, ${username}`;
      googleBtn.style.display = "none";
      userInfo.style.display = "block";
    } catch(err) {
      alert("Google Sign-In failed: "+err.message);
    }
  };

  // Party actions
  function createParty() {
    location.href = "host.html";
  }

  function joinParty() {
    const c = document.getElementById("code").value.trim();
    if(c.length !== 5) return alert("Invalid Code");
    sessionStorage.setItem("c", c);
    location.href = "controller.html";
  }
</script>

</body>
</html>
