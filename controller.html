<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Controller</title>
<style>
body{font-family:Arial;text-align:center;background:#f4f4f4;padding:20px}
button{display:block;width:100%;padding:15px;margin:10px 0;border:none;border-radius:8px;background:#2a5298;color:white;font-size:18px}
button:disabled{background:gray}
</style>
</head>
<body>

<h2 id="question"></h2>
<div id="answers"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

const app=initializeApp({
apiKey:"YOUR_API_KEY",
authDomain:"syncplay-17b6e.firebaseapp.com",
databaseURL:"https://syncplay-17b6e-default-rtdb.firebaseio.com",
projectId:"syncplay-17b6e"
});
const db=getDatabase(app);

const code=sessionStorage.getItem("c");
const uid=sessionStorage.getItem("uid");

const questions=[
{q:"Capital of Japan?",a:["Seoul","Tokyo","Bangkok","Beijing"]},
{q:"2+8?",a:["8","9","10","11"]},
{q:"Fastest land animal?",a:["Tiger","Cheetah","Lion","Horse"]}
];

onValue(ref(db,"parties/"+code),snap=>{
  const data=snap.val();
  if(!data||data.gameState!=="question") return;

  const q=questions[data.currentQuestion];
  document.getElementById("question").textContent=q.q;

  const div=document.getElementById("answers");
  div.innerHTML="";
  q.a.forEach((ans,i)=>{
    const btn=document.createElement("button");
    btn.textContent=ans;
    btn.onclick=()=>submit(i,data);
    div.appendChild(btn);
  });
});

function submit(choice,data){
  if(data.answered) return;

  if(choice===data.correct){
    update(ref(db,"parties/"+code+"/players/"+uid),{
      score:(data.players[uid].score||0)+1
    });
  }

  update(ref(db,"parties/"+code),{answered:true});
}
</script>
</body>
</html>
