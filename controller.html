<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Trivia Controller</title>
<style>
body{text-align:center;font-family:Arial;background:#f0f0f0;padding:20px}
button{display:block;width:100%;padding:15px;margin:8px 0;font-size:18px;border:none;border-radius:8px;background:#00bfa5;color:white}
</style>
</head>
<body>

<h2>Trivia</h2>
<h3 id="question"></h3>
<div id="answers"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

const app = initializeApp({
  apiKey:"YOUR_API_KEY",
  authDomain:"syncplay-17b6e.firebaseapp.com",
  databaseURL:"https://syncplay-17b6e-default-rtdb.firebaseio.com",
  projectId:"syncplay-17b6e"
});
const db=getDatabase(app);

const code=sessionStorage.getItem("c");
const uid=sessionStorage.getItem("uid");

onValue(ref(db,`parties/${code}`), snap=>{
  const data=snap.val();
  if(!data||data.gameState!=="question") return;

  const questions=[
  {q:"Capital of France?",a:["Berlin","Paris","Rome","Madrid"]},
  {q:"5 + 7 = ?",a:["10","12","14","15"]},
  {q:"Largest planet?",a:["Earth","Mars","Jupiter","Saturn"]}
  ];

  const q=questions[data.currentQuestion];
  document.getElementById("question").textContent=q.q;

  const ansDiv=document.getElementById("answers");
  ansDiv.innerHTML="";
  q.a.forEach((ans,i)=>{
    const btn=document.createElement("button");
    btn.textContent=ans;
    btn.onclick=()=>submit(i);
    ansDiv.appendChild(btn);
  });
});

function submit(choice){
  const partyRef=ref(db,`parties/${code}`);
  onValue(partyRef,snap=>{
    const data=snap.val();
    if(choice===data.correct){
      const scoreRef=ref(db,`parties/${code}/players/${uid}`);
      update(scoreRef,{score:(data.players[uid].score||0)+1});
    }
  },{onlyOnce:true});
}
</script>
</body>
</html>
